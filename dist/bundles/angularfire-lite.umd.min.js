!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("firebase"),require("@angular/common/http"),require("rxjs/Subject"),require("rxjs/Observable"),require("rxjs/observable/fromPromise"),require("@angular/common"),require("rxjs/add/observable/of"),require("rxjs/BehaviorSubject"),require("@angular/platform-browser"),require("rxjs/add/operator/map"),require("rxjs/add/operator/do"),require("firebase/firestore")):"function"==typeof define&&define.amd?define("angularfire-lite",["exports","@angular/core","firebase","@angular/common/http","rxjs/Subject","rxjs/Observable","rxjs/observable/fromPromise","@angular/common","rxjs/add/observable/of","rxjs/BehaviorSubject","@angular/platform-browser","rxjs/add/operator/map","rxjs/add/operator/do","firebase/firestore"],e):e(t["angularfire-lite"]={},t.ng.core,t.firebase,t.ng.common.http,t.Rx,t.Rx,t.Rx.Observable,t.ng.common,t.Rx.Observable,t.Rx,t.ng.platformBrowser)}(this,function(t,e,r,o,i,n,s,a,u,c,f){"use strict";function h(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,i,n=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(i)throw i.error}}return s}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}var l=function(){function t(t){this.appConfig=t}return t.prototype.instance=function(){return r.apps.length?r.app():r.initializeApp(this.appConfig)},t.prototype.config=function(){return this.appConfig},t}();l.decorators=[{type:e.Injectable}],l.ctorParameters=function(){return[{type:P}]};var d=function(){function t(t,e,r){this.app=t,this.http=e,this.platformId=r,this.browser=a.isPlatformBrowser(this.platformId),this.server=a.isPlatformServer(this.platformId),this.auth=t.instance().auth(),this.config=t.config()}return t.prototype.uid=function(){var t=this,e=new i.Subject;return this.isAuthenticated().subscribe(function(r){r?t.auth.onAuthStateChanged(function(t){e.next(t.uid)}):e.next(null)}),e},t.prototype.isAuthenticated=function(){var t=new i.Subject;return this.auth.onAuthStateChanged(function(e){t.next(!!e)}),t},t.prototype.isAnonymous=function(){var t=new i.Subject;return this.auth.onAuthStateChanged(function(e){t.next(e.isAnonymous)}),t},t.prototype.currentUser=function(){var t=new i.Subject;return t.next(this.auth.currentUser),t},t.prototype.userData=function(){var t=this;if(this.server)return this.auth.currentUser?s.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(e){return t.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getAccountInfo?key="+t.config.apiKey,{idToken:e})})):n.Observable.of({});if(this.browser){var e=new i.Subject;return this.auth.onAuthStateChanged(function(t){t&&e.next({displayName:t.displayName,email:t.email,emailVerified:t.emailVerified,photoURL:t.photoURL,isAnonymous:t.isAnonymous,uid:t.uid,providerData:t.providerData,phoneNumber:t.phoneNumber})}),e}},t.prototype.providers=function(t){if(this.server)return this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/createAuthUri?key="+this.config.apiKey,{identifier:t});if(this.browser){var e=new i.Subject;return this.auth.fetchProvidersForEmail(t).then(function(t){e.next(t)}),e}},t.prototype.signin=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key="+this.config.apiKey,{email:t,password:e,returnSecureToken:!0}):this.browser?s.fromPromise(this.auth.signInWithEmailAndPassword(t,e)):void 0},t.prototype.signinAnonymously=function(){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key="+this.config.apiKey,{returnSecureToken:!0}):this.browser?s.fromPromise(this.auth.signInAnonymously()):void 0},t.prototype.signup=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key="+this.config.apiKey,{email:t,password:e,returnSecureToken:!0}):this.browser?s.fromPromise(this.auth.createUserWithEmailAndPassword(t,e)):void 0},t.prototype.signout=function(){return s.fromPromise(this.auth.signOut())},t.prototype.updateProfile=function(t){var e,r=this;return this.server?(null===t.displayName&&null===t.photoURL?e="'PHOTO_URL' , 'DISPLAY_NAME'":null===t.displayName?e="DISPLAY_NAME":null===t.photoURL&&(e="PHOTO_URL"),this.auth.currentUser.getIdToken(!0).then(function(o){return r.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+r.config.apiKey,{idToken:o,displayName:t.displayName,photoUrl:t.photoURL,deleteAttribute:e,returnSecureToken:!0})})):this.browser?s.fromPromise(this.auth.currentUser.updateProfile(t)):void 0},t.prototype.updateEmail=function(t){var e=this;return this.server?this.auth.currentUser.getIdToken(!0).then(function(r){return e.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+e.config.apiKey,{idToken:r,email:t,returnSecureToken:!0})}):this.browser?s.fromPromise(this.auth.currentUser.updateEmail(t)):void 0},t.prototype.updatePassword=function(t){var e=this;return this.server?this.auth.currentUser.getIdToken(!0).then(function(r){return e.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/setAccountInfo?key="+e.config.apiKey,{idToken:r,password:t,returnSecureToken:!0})}):this.browser?s.fromPromise(this.auth.currentUser.updatePassword(t)):void 0},t.prototype.verifyPasswordResetCode=function(t){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/resetPassword?key="+this.config.apiKey,{oobCode:t}):this.browser?s.fromPromise(this.auth.verifyPasswordResetCode(t)):void 0},t.prototype.confirmPasswordReset=function(t,e){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/resetPassword?key="+this.config.apiKey,{oobCode:t,newPassword:e}):this.browser?s.fromPromise(this.auth.confirmPasswordReset(t,e)):void 0},t.prototype.relogin=function(t){return s.fromPromise(this.auth.currentUser.reauthenticateWithCredential(t))},t.prototype.deletePermanently=function(){var t=this;return this.server?s.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(e){return t.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/deleteAccount?key="+t.config.apiKey,{idToken:e})})):this.browser?s.fromPromise(this.auth.currentUser["delete"]()):void 0},t.prototype.sendEmailVerification=function(){var t=this;return this.server?s.fromPromise(this.auth.currentUser.getIdToken(!0).then(function(e){return t.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getOobConfirmationCode?key="+t.config.apiKey,{requestType:"VERIFY_EMAIL",idToken:e})})):this.browser?s.fromPromise(this.auth.currentUser.sendEmailVerification()):void 0},t.prototype.sendPasswordResetEmail=function(t){return this.server?this.http.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/getOobConfirmationCode?key="+this.config.apiKey,{requestType:"PASSWORD_RESET",email:t}):this.browser?s.fromPromise(this.auth.sendPasswordResetEmail(t)):void 0},t}();d.decorators=[{type:e.Injectable}],d.ctorParameters=function(){return[{type:l},{type:o.HttpClient},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var m=function(){function t(t,e,r,o){var i=this;this.app=t,this.http=e,this.state=r,this.platformId=o,this.server=a.isPlatformServer(this.platformId),this.browser=a.isPlatformBrowser(this.platformId),this.ref=function(t){return i.database.ref(t)},this.database=t.instance().database(),this.config=t.config()}return t.prototype.read=function(t){var e=f.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"value",e):void 0},t.prototype.childAdded=function(t){var e=f.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_added",e):void 0},t.prototype.childChanged=function(t){var e=f.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_changed",e):void 0},t.prototype.childRemoved=function(t){var e=f.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_removed",e):void 0},t.prototype.childMoved=function(t){var e=f.makeStateKey(t);return this.server?this.SRH(t,e):this.browser?this.BRH(t,"child_moved",e):void 0},t.prototype.SRH=function(t,e){var r=this;return this.http.get("https://"+this.config.projectId+".firebaseio.com/"+t+".json").map(function(t){if(t&&"object"==typeof t){var o=Object.keys(t).map(function(e){return[t[e]]});return r.state.set(e,o),o}return r.state.set(e,t),t})},t.prototype.BRH=function(t,e,r){if(this.browser){var o=this.state.get(r,[]),i=new c.BehaviorSubject(o);return this.ref(t).on(e,function(t){if(t.val()&&"object"==typeof t.val()){var e=Object.keys(t.val()).map(function(e){return[t.val()[e]]});i.next(e)}else i.next(t.val())}),i}},t.prototype.write=function(t,e){return this.server?this.http.put("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?s.fromPromise(this.ref(t).set(e)):void 0},t.prototype.push=function(t,e){return this.server?this.http.post("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?s.fromPromise(this.ref(t).push(e)):void 0},t.prototype.update=function(t,e){return this.server?this.http.patch("https://"+this.config.projectId+".firebaseio.com/"+t+".json?print=silent",e):this.browser?s.fromPromise(this.ref(t).update(e)):void 0},t.prototype.remove=function(t){return this.server?this.http["delete"]("https://"+this.config.projectId+".firebaseio.com/"+t+".json"):this.browser?s.fromPromise(this.ref(t).remove()):void 0},t.prototype.query=function(t){var e=this.platformId,r=this.state,o=this.database,i=this.http,n=this.config,s=function(t,e,o){return i.get("https://"+n.projectId+".firebaseio.com/"+t+".json?"+e).map(function(t){if(t&&"object"==typeof t){var e=Object.keys(t).map(function(e){return[t[e]]});return r.set(o,e),e}return r.set(o,t),t})},u=function(t){return function(e){if(e.val()&&"object"==typeof e.val()){var r=Object.keys(e.val()).map(function(t){return[e.val()[t]]});t.next(r)}else t.next(e.val())}},h="",p=this.ref(t);return{startAt:function(t){return h+="&startAt="+t,p=p.startAt(t),this},endAt:function(t){return h+="&endAt="+t,p=p.endAt(t),this},equalTo:function(t){return h+="&equalTo="+t,p=p.equalTo(t),this},isEqual:function(r){if(a.isPlatformBrowser(e))return o.ref(t).isEqual(r)},limitToFirst:function(t){return h+="&limitToFirst="+t,p=p.limitToFirst(t),this},limitToLast:function(t){return h+="&limitToLast="+t,p=p.limitToLast(t),this},orderByChild:function(t){return h+='&orderBy="'+t+'"',p=p.orderByChild(t),this},orderByKey:function(){return h+='&orderBy="$key"',p=p.orderByKey(),this},orderByPriority:function(){return h+='&orderBy="$priority"',p=p.orderByPriority(),this},orderByValue:function(){return h+='&orderBy="$value"',p=p.orderByValue(),this},on:function(o){var i=f.makeStateKey(t);if(a.isPlatformServer(e))return s(t,h,i);if(a.isPlatformBrowser(e)){var n=r.get(i,[]),l=new c.BehaviorSubject(n);return p.on(o,u(l)),l}},once:function(o){var i=f.makeStateKey(t);if(a.isPlatformServer(e))return s(t,h,i);if(a.isPlatformBrowser(e)){var n=r.get(i,[]),l=new c.BehaviorSubject(n);return p.once(o,u(l)),l}}}},t}();m.decorators=[{type:e.Injectable}],m.ctorParameters=function(){return[{type:l},{type:o.HttpClient},{type:f.TransferState},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var y=function(){function t(t,e,r,o){this.app=t,this.http=e,this.state=r,this.platformId=o,this.browser=a.isPlatformBrowser(this.platformId),this.firestore=t.instance().firestore(),this.config=t.config()}return t.prototype.read=function(t){var e=this;console.log("read from angularlite");var r=f.makeStateKey(t),o=t.split("/");"/"===o[0]&&o.shift(),"/"===o[o.length-1]&&o.pop();var i=o.length-1;if(a.isPlatformServer(this.platformId))return this.http.get("https://firestore.googleapis.com/v1beta1/projects/"+this.config.projectId+"/databases/(default)/documents/"+t).map(function(t){var e={};if(i%2!=0)return Object.keys(t.fields).forEach(function(r){for(var o in t.fields[r])o&&(e[r]=t.fields[r][o])}),e;var r=[];return t.documents.forEach(function(t){var e={};Object.keys(t.fields).forEach(function(r){for(var o in t.fields[r])o&&(e[r]=t.fields[r][o])}),r.push(e)}),r})["do"](function(t){e.state.set(r,t)});if(console.log("read request"),this.browser){var n=this.state.get(r,[]),s=new c.BehaviorSubject(n);return console.log("browser ->",this.browser),i%2==0?this.firestore.collection(t).onSnapshot(function(t){var e=[];t.docs.forEach(function(t){e.push(Object.assign({},t.data(),{$key:t.id}))}),console.log("data ->",e),s.next(e)}):this.firestore.doc(t).onSnapshot(function(t){s.next(Object.assign({},t.data(),{$key:t.id}))}),s}},t.prototype.write=function(t,e,r){if(this.browser)return s.fromPromise(this.firestore.doc(t).set(e,{merge:r}))},t.prototype.push=function(t,e){if(this.browser)return s.fromPromise(this.firestore.collection(t).add(e))},t.prototype.update=function(t,e){if(this.browser)return s.fromPromise(this.firestore.doc(t).update(e))},t.prototype.remove=function(t){return a.isPlatformServer(this.platformId)?this.http["delete"]("https://firestore.googleapis.com/v1beta1/projects/"+this.config.projectId+"/databases/(default)/documents/"+t):this.browser?s.fromPromise(this.firestore.doc(t)["delete"]()):void 0},t.prototype.removeField=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(this.browser)return s.fromPromise(this.firestore.doc(t).update(e))},t.prototype.removeCollection=function(t){var e=this;if(this.browser)return s.fromPromise(this.firestore.collection(t).get().then(function(t){t.docs.forEach(function(t){e.firestore.batch()["delete"](t.ref)})}))},t.prototype.query=function(t){var e=this.platformId,r=this.http,o=this.config,i=this.state,n=this.firestore,s={from:[{collectionId:""+t}]},u=function(t){var e=[];return r.post("https://firestore.googleapis.com/v1beta1/projects/"+o.projectId+"/databases/(default)/documents:runQuery",h).map(function(t){var r,o,i=function(t){var r={};Object.keys(t.document.fields).forEach(function(e){var o=Object.keys(t.document.fields[e]);r[e]=t.document.fields[e][o[0]]}),e.push(r)};try{for(var n=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}(t),s=n.next();!s.done;s=n.next()){i(s.value)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}return e})["do"](function(e){i.set(t,e)})},h={structuredQuery:s},l=[],d=n.collection(t);return{where:function(e,r,o){var i="";switch(r){case"<":i="LESS_THAN";break;case"<=":i="LESS_THAN_OR_EQUAL";break;case">":i="GREATER_THAN";break;case">=":i="GREATER_THAN_OR_EQUAL";break;case"==":i="EQUAL"}return s.where={},s.where.fieldFilter={},s.where.fieldFilter.field={},s.where.fieldFilter.field.fieldPath=t,s.where.fieldFilter.op=i,s.where.fieldFilter.value=v(o),d=d.where(e,r,o),this},startAt:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(v(t))}),s.startAt={},s.startAt.before=!0,s.startAt.values=r,d=d.startAt.apply(d,p(t)),this},startAfter:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(v(t))}),s.startAt={},s.startAt.before=!1,s.startAt.values=r,d=d.startAfter.apply(d,p(t)),this},endAt:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(v(t))}),s.endAt={},s.endAt.before=!1,s.endAt.values=r,d=d.endAt.apply(d,p(t)),this},endBefore:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return t.forEach(function(t){r.push(v(t))}),s.endAt={},s.endAt.before=!0,s.endAt.values=r,d=d.endBefore.apply(d,p(t)),this},limit:function(t){return s.limit=t,d=d.limit(t),this},orderBy:function(t,e){var r={field:{fieldPath:""}};switch(r.field.fieldPath=t,e){case"asc":r.direction="ASCENDING";break;case"desc":r.direction="DESCENDING"}return l.push(r),d=d.orderBy(t,e),s.orderBy=l,this},on:function(){var r=f.makeStateKey(t+":query");if(a.isPlatformServer(e))return u(r);if(a.isPlatformBrowser(e)){var o=i.get(r,[]),n=new c.BehaviorSubject(o);return d.onSnapshot(function(t){var e=[];t.forEach(function(t){e.push(t)}),n.next(e)}),n}},get:function(){var r=f.makeStateKey(t+":query");if(a.isPlatformServer(e))return u(r);if(a.isPlatformBrowser(e)){var o=[],n=i.get(r,[]),s=new c.BehaviorSubject(n);return d.get().then(function(t){t.forEach(function(t){o.push(t)}),s.next(o)}),s}}}},t.prototype.transaction=function(){if(this.browser){var t,e=this.firestore,r=0,o=function(t){return e.doc(t).get()},n=function(t,r){return e.doc(t).set(r)};return{set:function(e,r){return t=t.then(function(){n(e,r)}),this},get:function(e){var n=this,s=new i.Subject;return r>0?t=t.then(function(){o(e).then(function(t){s.next({data:t.data(),next:n})})}):0===r&&(t=o(e).then(function(t){s.next({data:t.data(),next:n})})),r++,s},run:function(){return s.fromPromise(e.runTransaction(function(){return t}))}}}console.log("transactions SSR is not supported yet")},t.prototype.batch=function(){if(this.browser){var t=this.firestore,e=this.firestore.batch();return{set:function(r,o){return e.set(t.doc(r),o),this},update:function(r,o){return e.update(t.doc(r),o),this},"delete":function(r){return e["delete"](t.doc(r)),this},commit:function(){return s.fromPromise(e.commit())}}}console.log("batched writes SSR is not supported yet")},t}();function v(t){switch(t){case"boolean"==typeof t:return{booleanValue:t};case"string"==typeof t:return{stringValue:t};case"number"==typeof t:return{doubleValue:t};case"object"==typeof t&&t:return{arrayValue:t}}}y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:l},{type:o.HttpClient},{type:f.TransferState},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var g=function(){function t(t,e){this.app=t,this.platformId=e,this.browser=a.isPlatformBrowser(this.platformId),this.storage=t.instance().storage()}return t.prototype.upload=function(t,e,r){if(this.browser)return s.fromPromise(this.child(t).put(e,r))},t.prototype.uploadString=function(t,e){if(this.browser)return s.fromPromise(this.child(t).putString(e))},t.prototype.download=function(t){if(this.browser)return s.fromPromise(this.child(t).getDownloadURL())},t.prototype.remove=function(t){if(this.browser)return s.fromPromise(this.child(t)["delete"]())},t.prototype.getMetadata=function(t){if(this.browser){var e=new i.Subject;return this.child(t).getMetadata().then(function(t){e.next(t)}),e}},t.prototype.updateMetadata=function(t,e){if(this.browser)return s.fromPromise(this.child(t).updateMetadata(e))},t.prototype.deleteMetadata=function(t){if(this.browser)return s.fromPromise(this.child(t).updateMetadata({customMetadata:null,cacheControl:null,contentEncoding:null,contentLanguage:null,contentType:null}))},t.prototype.child=function(t){return this.storage.ref().child(t)},t}();g.decorators=[{type:e.Injectable}],g.ctorParameters=function(){return[{type:l},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var b=function(){function t(t,e){this.app=t,this.platformId=e,this.browser=a.isPlatformBrowser(this.platformId),this.messaging=t.instance().messaging()}return t.prototype.instance=function(){if(this.browser)return this.messaging},t.prototype.token=function(){if(this.browser)return s.fromPromise(this.messaging.getToken())},t.prototype.tokenRefresh=function(){var t=this;if(this.browser){var e=new i.Subject;return this.messaging.onMessage(function(){t.messaging.getToken().then(function(t){e.next(t)})}),e}},t.prototype.requestPermission=function(){if(this.browser)return s.fromPromise(this.messaging.requestPermission())},t.prototype.deleteToken=function(t){if(this.browser)return s.fromPromise(this.messaging.deleteToken(t))},t}();function w(t){return new l(t)}b.decorators=[{type:e.Injectable}],b.ctorParameters=function(){return[{type:l},{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]};var P=function(){return function(){}}(),j=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:P,useValue:e},{provide:l,useFactory:w,deps:[P]},m,d,y,g,b]}},t}();j.decorators=[{type:e.NgModule,args:[{imports:[o.HttpClientModule,a.CommonModule,f.BrowserTransferStateModule]}]}],j.ctorParameters=function(){return[]},t.AngularFireLiteAppFactory=w,t.FirebaseAppConfig=P,t.AngularFireLite=j,t.AngularFireLiteApp=l,t.AngularFireLiteDatabase=m,t.AngularFireLiteStorage=g,t.AngularFireLiteMessaging=b,t.AngularFireLiteFirestore=y,t.FormatServerData=v,t.AngularFireLiteAuth=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angularfire-lite.umd.min.js.map
